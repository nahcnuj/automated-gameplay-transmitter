#!/usr/bin/env dash
set -eu

while true
do
    curl -s 'http://localhost:7777/api/talk' | \
        tee /tmp/speech.txt | \
        open_jtalk \
            -m /usr/share/hts-voice/nitech-jp-atr503-m001/nitech_jp_atr503_m001.htsvoice \
            -x /var/lib/mecab/dic/open-jtalk/naist-jdic \
            -ow /tmp/jsay.wav || :
    aplay -q /tmp/jsay.wav || :
    rm -f /tmp/jsay.wav
    truncate /tmp/speech.txt --size 0
    # sleep 1
done